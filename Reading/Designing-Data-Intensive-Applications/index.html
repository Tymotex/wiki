<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="CPU clock speed improvements have saturated. Unless they can continue to improve at a rate that matches our demand on fast CPUs, there is no choice but to use parallelism."><title>Designing Data Intensive Applications</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://wiki.timz.dev//icon.png><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:wght@400;600;700&family=Fira+Code:wght@400;700&display=swap" rel=stylesheet><link href=https://wiki.timz.dev/styles.f0166864fd6bb1603db547f1f970f84b.min.css rel=stylesheet><link href=https://wiki.timz.dev/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://wiki.timz.dev/js/darkmode.773d76aedcd615c64f644f542d60cb1b.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script src=https://wiki.timz.dev/js/popover.688c5dcb89a57776d7f1cbeaf6f7c44b.min.js></script>
<script src=https://wiki.timz.dev/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://wiki.timz.dev/js/clipboard.de8d8b2221fe27323078cbd76188e364.min.js></script>
<script>const BASE_URL="https://wiki.timz.dev/",fetchData=Promise.all([fetch("https://wiki.timz.dev/indices/linkIndex.fbe9c7711841b8b55f71659012a729bb.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://wiki.timz.dev/indices/contentIndex.5d83424f6cda619a05e29768d90548b1.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const n=new URL(BASE_URL),s=n.pathname,o=window.location.pathname,i=s==o;addCopyButtons();const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=i&&!0;drawGraph("https://wiki.timz.dev",t,[{"/Knowledge/Engineering":"#4388cc"},{"/Knowledge/Investing":"#98c379"},{"/Knowledge/Personal-Finance":"#98c379"},{"/Knowledge/Finance":"#FFD700"},{"/Knowledge/Economics":"#FFD700"}],t?{centerForce:1,depth:3,enableDrag:!0,enableLegend:!0,enableZoom:!0,fontSize:.4,linkDistance:1,opacityScale:3,repelForce:.2,scale:1.4}:{centerForce:1,depth:2,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:1,scale:3}),initPopover("https://wiki.timz.dev",!0,!0)},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}</script><script>window.Million={navigate:e=>window.location.href=e,prefetch:()=>{}},window.addEventListener("DOMContentLoaded",()=>{init(),render()})</script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://wiki.timz.dev/js/search.cf33b507388f3dfd5513a2afcda7af41.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://wiki.timz.dev/js/graph.0ac96ed5ea296a8b1ac03a6eba11878c.js></script><div class=singlePage><header><h1 id=page-title><a href=https://wiki.timz.dev/>ðŸŒ± Tim's Dev Wiki</a></h1><svg tabindex="0" id="search-icon" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg><div class=spacer></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Designing Data Intensive Applications</h1><p class=meta>Last updated August 28, 2023.</p><ul class=tags></ul><aside class=mainTOC><details open><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#chapter-1>Chapter 1</a></li><li><a href=#chapter-2>Chapter 2</a></li></ol></nav></details></aside><p>CPU clock speed improvements have saturated. Unless they can continue to improve at a rate that matches our demand on fast CPUs, there is no choice but to use <em>parallelism</em>.</p><p><em>Data-intensive applications</em> refer to software where the main challenge is dealing with the massive amount of data and its complexity. <em>Compute-intensive</em> applications are those where CPU power is the main bottleneck rather than the amount/complexity of data.</p><a href=#chapter-1><h2 id=chapter-1><span class=hanchor arialabel=Anchor># </span>Chapter 1</h2></a><ul><li><strong>Reliability</strong>: fault-tolerance, or the &ldquo;continuing to work correctly even when things go wrong.&rdquo;<ul><li>It&rsquo;s not a bad idea to deliberately cause faults to continually exercise the system&rsquo;s reliability. E.g. you might constantly randomly kill servers, which is what
<a href=https://netflix.github.io/chaosmonkey/ rel=noopener>Netflix&rsquo;s Chaos Monkey</a> does.</li><li><em>Redundancy</em> is the first strategy to having fault-tolerance - when one thing dies, fail over to the backup.</li></ul></li><li><strong>Scalability</strong>: when data/traffic/complexity grows, the system should toelrate that growth.</li><li><strong>Maintainability</strong>: how easy is this system to change.</li></ul><p>There are a few universal things data-intensive software always need to do:****</p><ul><li><strong>Databases</strong> - store stuff persistently.</li><li><strong>Caches</strong> - keep results of operations that were expensive to run.</li><li><strong>Search indexes</strong> - search through data quickly by using a supporting data structure called a search index.</li><li><strong>Message queuing</strong> - to communicate data between servers asynchronously.</li><li><strong>Batch processing</strong> - do computationally heavy things outside of the main serving logic.
<img src=/Reading/assets/ddia-simple-data-system.png width=600></li></ul><p>Human errors in some systems are the <em>leading</em> cause of outages. Systems need to be designed in a way that account for the unreliability of human operators.</p><ul><li>Provide &lsquo;dev&rsquo;/sandbox instances of the service so that human operators can test changes before committing those changes to production.</li><li>Have fast and easy rollback mechanisms.</li><li>Canarying - roll out new code changes slowly in a step-wise fashion.</li></ul><p><strong>Fan-out</strong> (and fan-in) is a challenge in some systems - where to serve one request you might need to do an operation that touches many different things in parallel. <em>A single request might expand into many operations</em>.</p><ul><li>E.g. you make a post to Facebook, then that needs to appear in the home feed of all your friends.
<img src=/Reading/assets/twitter-fan-out.png width=700><ul><li>In Twitter&rsquo;s case, they need to care about a parameter called <em>fan-out load</em>, where one tweet request by Elon Musk might need to be distributed to 100 million+ followers.</li></ul></li><li><em>Fan-out</em> - a term in electronic engineering describing the number of logic gates that a particular logic gate outputs to
<img src=/Reading/assets/fan-out.png width=200></li></ul><p>Questions:</p><ul><li>Telemetry vs. monitoring vs. observability.</li></ul><p>Random notes:</p><ul><li>Monitoring:<ul><li>Latency != response time. Response time is the metric specific to the experience of the user of your system. It&rsquo;s a time that includes all the delays along the way like network delays.</li><li>In monitoring, percentiles are generally much more useful than averages. The median (50th percentile value) is generally better at reflecting typical user experience.</li><li>Higher percentiles are referred to as &rsquo;tails&rsquo;. In particular, tail latencies are of interest in many systems - e.g. in Amazon, the users experiencing tail latencies are often the most profit-producing customers.<ul><li><em>Tail latency amplification</em> is a common consequence arising from <em>head-of-line blocking</em>. If you send a request that is slow to process, it might &lsquo;clog the line&rsquo; and your subsequent requests will also probably be slower.</li></ul></li></ul></li><li>System design:<ul><li>A discussion of &lsquo;scalability&rsquo; should be in terms of &lsquo;how does this system cope with increases in X <em>load parameter</em>&rsquo;, where load parameters include things like: <em>fan-out load</em>, read-to-write ratio, etc.</li><li>The &lsquo;right&rsquo; architecture for a service always depends on what the service expects its <em>load parameters</em> to be.</li><li>System designs should always strive to optimise for:<ul><li>Operability: easy for ops teams to manage.<ul><li>There should be good monitoring, good troubleshooting guides, good way to anticipate problems, etc.</li></ul></li><li>Simplicity: easy for engineers to understand.</li><li>Evolvability: easy for engineers to make changes to.</li></ul></li></ul></li></ul><a href=#chapter-2><h2 id=chapter-2><span class=hanchor arialabel=Anchor># </span>Chapter 2</h2></a><p>Data modeling is deciding what interface/abstraction to present to the world, and what &rsquo;things&rsquo; your system reasons with. The abstraction you presents matters a lot &ndash; it defines what the systems using your service can and can&rsquo;t do.</p><p><strong>Relational data modeling</strong> where you organise things into rows in tables, and have rows referencing rows in other tables, is the dominant way of data modeling for the few decades following its rise in 1970. Doing it this way tended to create very clean abstractions.</p><p>&lsquo;NoSQL&rsquo; was meant to just be a Twitter hashtag, but it became the main label we give to non-relational databases. It&rsquo;s been retroactively interpreted as &rsquo;not only SQL&rsquo;.</p><ul><li>NoSQL databases were intended to be an answer to relational databases&rsquo; scalability challenges for huge write traffic and huge tables, and as an alternative for expressing data models in a way that was more permissive and easy to evolve over time.</li><li><strong>Object-relational mismatch problem</strong> - if you model your system with OOP but use a relational database, then there needs to exist a way to map your system&rsquo;s object models to your relational database&rsquo;s table schema. <em>This is what an ORM (object-relational mapper) achieves</em>.</li></ul><p><a href=https://en.wikipedia.org/wiki/Polyglot_persistence rel=noopener>Polyglot persistence</a> is the practice of using different kinds of data storage technologies for a service. It&rsquo;s a bit like polyglot programming where you use 2+ languages for one program in order to leverage the strengths of one language for specific requirements of the program.</p><p>In many cases, storing data as a JSON offers better <strong>locality</strong> than storing one part in a table and its many other related rows in a different table. To fetch certain data, you need only fetch the JSON and pull out the things you need, whereas you might need to write a somewhat complex SQL query touching multiple tables to get what you need.</p><ul><li>E.g. Consider your app that has users and posts. Users have many posts. Using a relational database, you&rsquo;d have a <code>Users</code> table and a <code>Posts</code> table, where posts reference a <code>user_id</code>. In this case, getting a user and their posts together involves a SQL <code>SELECT ... FROM Users JOIN Posts ON Users.id=Posts.user_id</code>, for example. If you were to store a JSON, you could do it like this and just have one simple fetch for all the information you need:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>	&#34;users&#34; = {
</span></span><span class=line><span class=cl>		&#34;Linus&#34;: {
</span></span><span class=line><span class=cl>			...
</span></span><span class=line><span class=cl>			posts: [ ... ]
</span></span><span class=line><span class=cl>		},
</span></span><span class=line><span class=cl>		...
</span></span><span class=line><span class=cl>	}
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p><strong>ID or raw string?</strong> Often when designing the data model, you have a choice of making a string field an ID (which might come from a dropdown of fixed options) or a raw string which (might come from a freeform input field that the user types in).</p><ul><li>Reasons for using IDs:<ul><li>It never needs to change because it has no human-readable meaning.</li><li>It reduces duplication, reduces risk of inconsistency between redundant copies, and makes updates have less overhead. Generally, this is the main idea behind <strong>normalisation</strong> in databases.</li></ul></li><li>Reasons <em>not</em> to use IDs:<ul><li>Unlike relational databases, document-oriented databases may not support joins on IDs or have weak support for them. In that case, you&rsquo;d have to do multiple queries&mldr; &lsquo;<em>the work of making the join is shifted from the database to the application code.</em>&rsquo;</li><li></li></ul></li></ul></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div></div><div id=contact_buttons><footer><ul><li><a href=/>Home</a></li><li><a href=https://timz.dev>timz.dev</a></li><li><a href=https://github.com/Tymotex/wiki>Github</a></li><li><a href=https://www.linkedin.com/in/timz-seng>LinkedIn</a></li></ul><p>Tim Zhang Â© 2023</p></footer></div></div></body></html>